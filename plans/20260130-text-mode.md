# Text Mode Implementation Plan

Currently, the frontend only receives bounding box data for words ("Interactive Mode"), making it difficult to select or copy text naturally.
This plan introduces a "Text Mode" that displays the raw OCR text, allowing for standard text interaction.

## User Review Required

> [!IMPORTANT]
> This change requires modifying the backend streaming response structure. While backward compatible (new field), ensuring the frontend types match is crucial.

## Proposed Changes

### Backend API Specification (`src/routers/pdf.py`)

**Endpoint**: `GET /stream/{task_id}` (Server-Sent Events)

**Response Format Update**:
The `data` field in the SSE event `type: page` will be extended.

**Existing Format**:

```json
{
  "type": "page",
  "data": {
    "page_num": 1,
    "image_url": "https://...",
    "width": 1000,
    "height": 1400,
    "words": [...]
  }
}
```

**New Format**:

```json
{
  "type": "page",
  "data": {
    "page_num": 1,
    "image_url": "https://...",
    "width": 1000,
    "height": 1400,
    "words": [...],
    "text": "Extracted raw text content of the page..." // [NEW] Added field
  }
}
```

**Implementation Details**:

1.  In `stream` endpoint's `json_generate` function:
2.  When constructing `page_payload`, verify `page_text` exists.
3.  Add `page_payload["text"] = page_text`.
4.  Ensure this is done for both live OCR path and cached content path.

### Frontend

#### Types (`frontend/src/components/PDF/types.ts`)

- Update `PageData` interface to include `text?: string`.

#### PDFViewer (`frontend/src/components/PDF/PDFViewer.tsx`)

- Add `isTextMode` state.
- Add a toggle button in the control bar to switch between "Interactive" and "Text" modes.
- Pass `isTextMode` to `PDFPage`.

#### PDFPage (`frontend/src/components/PDF/PDFPage.tsx`)

- Accept `isTextMode` prop.
- If `isTextMode` is true:
  - Hide the image and word overlays.
  - Display `page.text` in a readable format (e.g., `whitespace-pre-wrap`, proper typography).
  - Ensure styling matches the "Terrace Vibe" (comfortable reading width, font).

## Verification Plan

### Automated Tests

- None specific for UI rendering, but unit tests for backend `stream` response structure could be added if time permits.

### Manual Verification

1. Upload a PDF.
2. Verify "Interactive Mode" works as before (clicking words opens dictionary).
3. Click "Text Mode" toggle.
4. Verify raw text is displayed and can be selected/copied.
5. Verify layout is comfortable to read.
