<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI English Reader | Full-Wide View</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* カスタム改行ルール：単語の途中でも強制的に折る設定 */
      .force-wrap {
        overflow-wrap: anywhere;
        word-break: break-word;
      }
      /* スムーズなスクロール */
      html {
        scroll-behavior: smooth;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-900 min-h-screen">
    <div class="w-full px-4 py-6">
      <header class="mb-8 px-2">
        <h1 class="text-3xl font-extrabold text-indigo-700 inline-block">
          English Vocab Analyzer
        </h1>
        <span class="ml-4 text-gray-500 text-sm italic"
          >Jamdict & Gemini AI Hybrid Mode</span
        >
      </header>

      <div
        class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8"
      >
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
          <form
            hx-post="/analyze_txt"
            hx-target="#results"
            hx-indicator="#loading"
            class="flex flex-col"
          >
            <label class="text-xs font-bold text-gray-400 uppercase mb-2"
              >Manual Text Input</label
            >
            <textarea
              name="html_text"
              rows="3"
              class="w-full border-gray-200 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 p-3 border text-sm"
              placeholder="Paste English text here..."
            ></textarea>
            <button
              type="submit"
              class="mt-3 bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition shadow-md"
            >
              Analyze Text
            </button>
          </form>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <form
              hx-post="/analyze-url"
              hx-target="#results"
              hx-indicator="#loading"
              class="bg-gray-50 p-4 rounded-lg border border-gray-200"
            >
              <label
                class="block text-xs font-bold text-gray-400 uppercase mb-2"
                >From URL</label
              >
              <input
                type="url"
                name="url"
                class="w-full p-2 border rounded text-sm mb-2"
                placeholder="https://..."
              />
              <button
                type="submit"
                class="text-indigo-600 text-sm font-bold hover:text-indigo-800 flex items-center"
              >
                <span>Extract from Web</span>
                <svg
                  class="w-4 h-4 ml-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                </svg>
              </button>
            </form>

            <form
              hx-post="/analyze-pdf"
              hx-target="#results"
              hx-encoding="multipart/form-data"
              hx-indicator="#loading"
              class="bg-gray-50 p-4 rounded-lg border border-gray-200"
            >
              <label
                class="block text-xs font-bold text-gray-400 uppercase mb-2"
                >From PDF</label
              >
              <input
                type="file"
                name="file"
                accept="application/pdf"
                class="w-full text-xs file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:bg-indigo-100 file:text-indigo-700 hover:file:bg-indigo-200"
              />
              <button
                type="submit"
                class="mt-2 text-indigo-600 text-sm font-bold hover:text-indigo-800 flex items-center"
              >
                <span>Analyze PDF</span>
                <svg
                  class="w-4 h-4 ml-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  ></path>
                </svg>
              </button>
            </form>
          </div>
        </div>

        <div
          id="loading"
          class="htmx-indicator mt-4 flex items-center justify-center text-indigo-600"
        >
          <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          <span class="text-sm font-medium">Analyzing content...</span>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
        <div
          class="lg:col-span-4 bg-white rounded-xl shadow-sm border border-gray-100 p-8 min-h-screen min-w-0"
        >
          <div
            class="flex items-center justify-between mb-6 border-b border-gray-50 pb-4"
          >
            <h2
              class="text-xs font-bold text-gray-400 uppercase tracking-widest"
            >
              Reader View
            </h2>
            <span class="text-xs text-gray-300">Click words to translate</span>
          </div>

          <div
            id="results"
            class="prose prose-indigo max-w-none text-lg leading-relaxed text-gray-800 force-wrap"
          >
            <p class="text-gray-300 italic">
              No content analyzed yet. Please provide text or a file above.
            </p>
          </div>
        </div>

        <div class="lg:col-span-1">
          <div class="sticky top-6">
            <h2
              class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-3"
            >
              Dictionary / AI
            </h2>

            <div
              id="definition-box"
              class="min-h-[250px] bg-white rounded-xl shadow-sm border border-gray-100 p-5"
            >
              <div
                class="flex flex-col items-center justify-center h-full text-center py-10"
              >
                <svg
                  class="w-10 h-10 text-gray-100 mb-3"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"
                  ></path>
                </svg>
                <p class="text-gray-400 text-xs">
                  本文の単語をクリックすると<br />意味を表示します
                </p>
              </div>
            </div>

            <div id="history-box" class="mt-6">
              <h3 class="text-[10px] font-bold text-gray-300 uppercase mb-2">
                Quick Tips
              </h3>
              <div
                class="text-[11px] text-gray-400 leading-normal bg-gray-50 p-3 rounded-md"
              >
                ・Jamdictで見つからない語はGeminiが自動補完します。<br />
                ・専門用語もクリック1つで解説。
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
