# Figure Insight 自動化実装確認用手順書

本手順書は、Figure Insight機能が自動化され、PDFアップロードと同時に実行されることを確認するためのものです。

## 1. 概要

Figure Insight（図表解説）機能について、従来の手動アップロード機能を廃止し、PDF解析時に自動的に図表を抽出し、バックグラウンドで解説生成を行うように改修しました。

## 2. 確認手順

### 手順 1: PDFのアップロード

1. PaperTerrace アプリケーションを開きます。
2. 左上の「Upload PDF」から、図表（Figure/Table）を含む英語論文PDFをアップロードします。
3. "Analyzing PDF..." の表示とともに解析が開始されることを確認します。
   - 解析中、ページごとにOCR結果が表示されます（HTMXストリームまたはJSONストリーム）。

### 手順 2: 図表抽出と自動解説の確認 (Logs)

1. サーバーのログを確認できる場合、以下のログが出力されているか確認します。
   - `[Figure] Found X images on page Y`: 指定ページから画像を抽出したログ。
   - `Saving X extracted figures for paper ...`: 抽出された全図表をDBに保存したログ。
   - `[Auto-Explain] Completed for figure ...`: バックグラウンドで自動解説が完了したログ。

### 手順 3: Figuresタブの確認

1. 解析完了後、サイドバーの「Figs」タブをクリックします。
2. 論文から抽出された図表が一覧表示されていることを確認します。
3. 各図表の下部に、日本語による解説（Explanation）が表示されているか確認します。
   - **注記**: 解説はバックグラウンド生成されるため、PDF解析完了直後はまだ生成中（空欄または「Generate Insight」ボタン）の場合があります。数秒〜数十秒待ってタブをリロードし、解説が表示されるか確認してください。

## 3. 期待される動作

- ユーザーが手動で画像を切り取ったりアップロードしたりする必要がないこと。
- PDF内の主要な図表が自動的にリストアップされること。
- プレミアムプラン等の制限なく（今回は全ユーザー対象として実装）、自動的に解説生成タスクが走ること。

## 4. トラブルシューティング

- **図表が表示されない:**
  - PDF内の画像が小さすぎる（5KB以下）場合はスキップされます。
  - 画像として埋め込まれていないベクター形式の図表は、現時点では抽出できない場合があります。
- **解説が表示されない:**
  - Gemini APIの制限やエラーにより生成に失敗している可能性があります。サーバーログの `[Auto-Explain] Failed` を確認してください。
  - 手動で "Generate Insight" を押して再生成できるか確認してください。
